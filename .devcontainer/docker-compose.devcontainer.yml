version: "3.9"

services:
  workspace:
    image: mcr.microsoft.com/devcontainers/typescript-node:20
    working_dir: /workspace
    command: sleep infinity
    user: node
    # ❌ Никаких монтирований проекта и node_modules здесь
    volumes:
      - ssh_node:/home/node/.ssh
    environment:
      NODE_OPTIONS: --max_old_space_size=4096
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - yachtpricer-net   # имя сети как в docker-compose.yml

  prisma-studio:
    image: node:20-alpine
    working_dir: /workspace/backend
    command: >
      sh -lc '
        echo "Using Prisma 6.14.0";
        npx -y prisma@6.14.0 studio
          --port 5555
          --schema=/workspace/backend/prisma/schema.prisma
      '
    environment:
      DATABASE_URL: postgres://postgres:postgres@db:5432/yachtpricer?schema=public
    # ❌ проект не монтируем — его смонтирует devcontainer сам
    # ❌ volumes для node_modules тоже не нужны
    ports:
      - "5556:5555"
    depends_on:
      - db
    networks:
      - yachtpricer-net

volumes:
  ssh_node:

networks:
  yachtpricer-net:
    # без external: true — пусть compose/VS Code создаёт сеть сам