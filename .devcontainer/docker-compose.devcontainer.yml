version: "3.9"

services:
  workspace:
    image: mcr.microsoft.com/devcontainers/typescript-node:20
    volumes:
      - .:/workspace:cached   # ðŸ‘ˆ Ð²Ð¼ÐµÑÑ‚Ð¾ ..
      - workspace-frontend-node_modules:/workspace/frontend/node_modules
      - workspace-backend-node_modules:/workspace/backend/node_modules
    working_dir: /workspace
    command: sleep infinity
    environment:
      VITE_CLERK_PUBLISHABLE_KEY: ${VITE_CLERK_PUBLISHABLE_KEY:-pk_test_dummy}

  prisma-studio:
    image: node:20-alpine
    working_dir: /workspace/backend
    # Ð’ÐÐ–ÐÐž: Ð¿Ð¸Ð½ÑƒÐµÐ¼ Ð²ÐµÑ€ÑÐ¸ÑŽ CLI = 6.14.0 (ÐºÐ°Ðº Ñƒ Prisma Client),
    # Ð¸ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ Ðº schema.prisma
    command: >
      sh -lc '
        echo "Using Prisma 6.14.0";
        npx -y prisma@6.14.0 studio
          --port 5555
          --schema=/workspace/backend/prisma/schema.prisma
      '
    environment:
      DATABASE_URL: postgres://postgres:postgres@db:5432/yachtpricer?schema=public
    volumes:
      - /Users/leonidk/Developer/YachPricer/yachtpricer-mvp:/workspace:cached
    ports:
      - "5556:5555"
    depends_on:
      - db

volumes:
  workspace-frontend-node_modules:
  workspace-backend-node_modules: