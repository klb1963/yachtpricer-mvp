–ü–ª–∞–Ω –æ—Ç–ª–∏—á–Ω—ã–π üí™ –î–∞–≤–∞–π —Å—Ä–∞–∑—É –æ—Ñ–æ—Ä–º–ª—é –µ–≥–æ –≤ —Å—Ç—Ä–æ–π–Ω—É—é –¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –≤—ã —Å –õ–∏–¥–æ–π –º–æ–≥–ª–∏ ‚Äú—Ä–∞–∑—ã–≥—Ä—ã–≤–∞—Ç—å‚Äù –ø—Ä–æ—Ü–µ—Å—Å –≤–∂–∏–≤—É—é.

–ß—Ç–æ –¥–æ–¥–µ–ª–∞—Ç—å (–∏ –∫–∞–∫)

1) –°—Ç–∞—Ç—É—Å—ã –ø–æ –∫–Ω–æ–ø–∫–∞–º (Submit/Approve/Reject)

–ë—ç–∫–µ–Ω–¥
	‚Ä¢	–û—Å—Ç–∞–≤–ª—è–µ–º –µ–¥–∏–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç (–∫–∞–∫ —Å–µ–π—á–∞—Å): POST /api/pricing/status
–¢–µ–ª–æ: { yachtId, week, status: 'SUBMITTED'|'APPROVED'|'REJECTED', comment?: string }
	‚Ä¢	RBAC —É–∂–µ –µ—Å—Ç—å –≤ PricingService.changeStatus ‚Äî –¥–æ–±–∞–≤–∏–º —Ç—É–¥–∞ –ø—Ä–∏—ë–º comment –∏ –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª (—Å–º. –ø.3).
	‚Ä¢	–í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É —Ä–µ—à–µ–Ω–∏—è + –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ perms.

–§—Ä–æ–Ω—Ç
	‚Ä¢	–ö–Ω–æ–ø–∫–∏ —É–∂–µ –µ—Å—Ç—å. –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
	‚Ä¢	–ü–µ—Ä–µ–¥ APPROVED/REJECTED –∏ –ø–æ –∂–µ–ª–∞–Ω–∏—é –ø—Ä–∏ SUBMITTED –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–æ–¥–∞–ª–∫—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (—Å–º. –ø.2).
	‚Ä¢	–ü–æ—Å–ª–µ await changeStatus(...) –¥–µ–ª–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ (–∫–∞–∫ —Å–µ–π—á–∞—Å), –ª–∏–±–æ —Ä–µ—Ñ–µ—Ç—á –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–µ—Å–ª–∏ –±—É–¥–µ—Ç /rows/:id ‚Äî –Ω–µ –æ–±—è–∑.)

2) –û–∫–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–º–æ–¥–∞–ª–∫–∞)
	‚Ä¢	–†–µ–∞–ª–∏–∑—É–µ–º –µ–¥–∏–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç DecisionCommentModal:
	‚Ä¢	–ü–æ–ª—è: textarea, —Å—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤, –∫–Ω–æ–ø–∫–∏ OK/Cancel.
	‚Ä¢	–í–∞–ª–∏–¥–∞—Ü–∏—è: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ REJECTED, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ SUBMITTED/APPROVED.
	‚Ä¢	–ü—Ä–æ–±—Ä–æ—Å onConfirm(comment: string) –≤ —Ä–æ–¥–∏—Ç–µ–ª—è ‚Äî –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç changeStatus(..., { comment }).

UI-–¥–µ—Ç–∞–ª–∏:
	‚Ä¢	–õ—ë–≥–∫–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (—Å–∏–Ω—è—è ‚Äî Submit, –∑–µ–ª—ë–Ω–∞—è ‚Äî Approve, –∫—Ä–∞—Å–Ω–∞—è ‚Äî Reject).
	‚Ä¢	Disable Primary, –µ—Å–ª–∏ comment –ø—É—Å—Ç–æ–π –∏ status==='REJECTED'.

3) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ + –∞—É–¥–∏—Ç

–ß—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ—à–µ–Ω–∏–π –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π ‚Äî –≤–≤–æ–¥–∏–º –∏—Å—Ç–æ—Ä–∏—é.

–°—Ö–µ–º–∞ (Prisma)

model PricingDecision {
  yachtId     String
  weekStart   DateTime
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
  status      DecisionStatus   @default(DRAFT)
  submittedById String?        @db.Uuid
  approvedById  String?        @db.Uuid
  rejectedById  String?        @db.Uuid
  approvedAt    DateTime?
  // —Å–≤—è–∑—å —Å –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π:
  comments    PricingDecisionComment[]

  @@id([yachtId, weekStart])
}

model PricingDecisionComment {
  id          String            @id @default(uuid())
  yachtId     String
  weekStart   DateTime
  authorId    String            @db.Uuid
  action      DecisionAction    // 'SUBMIT' | 'APPROVE' | 'REJECT' | 'COMMENT'
  message     String
  createdAt   DateTime          @default(now())

  decision    PricingDecision   @relation(fields: [yachtId, weekStart], references: [yachtId, weekStart], onDelete: Cascade)

  @@index([yachtId, weekStart])
}

enum DecisionAction {
  SUBMIT
  APPROVE
  REJECT
  COMMENT
}

–ë—ç–∫–µ–Ω–¥
	‚Ä¢	–í changeStatus() –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞:
	‚Ä¢	–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å submittedById/approvedById/rejectedById –∏ approvedAt –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ.
	‚Ä¢	–î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å—å –≤ PricingDecisionComment —Å action –∏ message (–µ—Å–ª–∏ –ø—É—Å—Ç–æ –ø—Ä–∏ SUBMIT/APPROVE ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ action –±–µ–∑ message, –∏–ª–∏ message = ‚Äò‚Äô).
	‚Ä¢	(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –í upsertDecision() ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è ‚Äú–ø—Ä–æ—Å—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è‚Äù –±–µ–∑ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞:
POST /api/pricing/comment { yachtId, week, message } ‚Üí action: 'COMMENT'.

–§—Ä–æ–Ω—Ç
	‚Ä¢	–ü–æ—Å–ª–µ changeStatus(...) –ø–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º.
	‚Ä¢	–í –∫–∞—Ä—Ç–æ—á–∫–µ/—Å—Ç—Ä–æ–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–∫–æ–Ω–∫—É ‚Äúspeech bubble‚Äù ‚Üí —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –∏—Å—Ç–æ—Ä–∏–∏.

4) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
	‚Ä¢	–£–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º discountPct/finalPrice —á–µ—Ä–µ–∑ upsertDecision.
	‚Ä¢	–î–æ–±–∞–≤–∏–º –ø—Ä–∞–≤–∏–ª–æ: –ø—Ä–∏ APPROVED —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª–∫—É:
	‚Ä¢	–ù–∞ –±—ç–∫–µ: –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ APPROVED, —Ç–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–π upsertDecision (RBAC canEditDraft —É–∂–µ –ø–æ—á—Ç–∏ –≤—Å—ë –¥–µ–ª–∞–µ—Ç; –º–æ–∂–Ω–æ –∂–µ—Å—Ç–∫–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–ø–¥–µ–π—Ç—ã –¥–ª—è non-draft).
	‚Ä¢	(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—Ä–∏ APPROVED –ø–∏—Å–∞—Ç—å –≤ PriceHistory/PriceAuditLog (–µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –µ—Å—Ç—å).

5) –ß—Ç–æ –µ—â—ë –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å
	‚Ä¢	–ü–µ—Ä–º–∏—à–µ–Ω—ã –≤ rows: –¥–æ–±–∞–≤–∏—Ç—å perms.canEditDraft (—á—Ç–æ–±—ã –ø–æ–ª—è –≤–≤–æ–¥–∞ –±—ã–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã, –µ—Å–ª–∏ –Ω–µ–ª—å–∑—è –ø—Ä–∞–≤–∏—Ç—å).
	‚Ä¢	–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: —Å–µ–π—á–∞—Å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ canSubmit/canApproveOrReject. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π –∂—ë—Å—Ç–∫—É—é –º–∞—Ç—Ä–∏—Ü—É:
	‚Ä¢	DRAFT -> SUBMITTED (Submit)
	‚Ä¢	SUBMITTED -> APPROVED (Approve)
	‚Ä¢	SUBMITTED -> REJECTED (Reject)
	‚Ä¢	REJECTED -> SUBMITTED (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)
	‚Ä¢	–û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî 400/409.
	‚Ä¢	–†–∞–∑–Ω—ã–µ org: —É–∂–µ —É—á—Ç–µ–Ω–æ –≤ AccessCtxService. –ù–µ –∑–∞–±—ã–≤–∞–µ–º –ø—Ä–æ –∞–≤–∞—Ä–∏–π–Ω—ã–µ –ø–æ–ª–Ω–æ–º–æ—á–∏—è Admin/Fleet.
	‚Ä¢	–¢–µ–∫—Å—Ç—ã –æ—à–∏–±–æ–∫: —Ñ—Ä–æ–Ω—Ç —É–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äú–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤‚Äù –ø–æ 403; –¥–æ–±–∞–≤—å —Ç–æ—Å—Ç ‚Äú–ù–µ–ª—å–∑—è –ø–æ–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ‚Äù –ø–æ 409/400.
	‚Ä¢	–¢–µ—Å—Ç—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–º–∏–Ω–∏–º—É–º):
	1.	MANAGER —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∏ Submit ‚Üí FLEET_MANAGER/ADMIN –≤–∏–¥–∏—Ç Approve/Reject.
	2.	FLEET_MANAGER –¥–µ–ª–∞–µ—Ç Reject —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∫–æ–º–º–µ–Ω—Ç–æ–º ‚Üí MANAGER —Å–Ω–æ–≤–∞ –≤–∏–¥–∏—Ç Submit.
	3.	FLEET_MANAGER –¥–µ–ª–∞–µ—Ç Approve ‚Üí MANAGER –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–ª—è disabled, –∫–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã—Ç—ã.
	4.	–†–∞–∑–Ω—ã–µ org ‚Üí –∫–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã—Ç—ã —É —Ñ—Ä–æ–Ω—Ç–∞ –∏ 403 —É –±—ç–∫–∞.
	5.	ADMIN ‚Äú–∞–≤–∞—Ä–∏–π–Ω–æ‚Äù –º–æ–∂–µ—Ç –≤—Å—ë –Ω–∞ –ª—é–±–æ–º –æ–±—ä–µ–∫—Ç–µ.
	‚Ä¢	–ò—Å—Ç–æ—Ä–∏—è (UI): –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –º–æ–¥–∞–ª–∫–∞ ‚ÄúHistory‚Äù:
	‚Ä¢	2025-09-14 19:05 ‚Äî Leonid (MANAGER): SUBMIT
	‚Ä¢	2025-09-14 19:12 ‚Äî Bob (FLEET_MANAGER): REJECT ‚Äî "—Å–ª–∏—à–∫–æ–º –¥—ë—à–µ–≤–æ"
	‚Ä¢	‚Ä¶

‚∏ª

–•–æ—á–µ—à—å ‚Äî —è —Å—Ä–∞–∑—É –Ω–∞–∫–∏–Ω—É:
	‚Ä¢	–º–∏–≥—Ä–∞—Ü–∏—é Prisma –ø–æ–¥ PricingDecisionComment,
	‚Ä¢	–ø–∞—Ç—á–∏ –≤ PricingService.changeStatus() (—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è, —Ñ–∏–∫—Å–∞—Ü–∏—è –ø–æ–ª–µ–π submittedById/approvedById/...),
	‚Ä¢	—Ñ—Ä–æ–Ω—Ç–æ–≤—É—é –º–æ–¥–∞–ª–∫—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∏ –ø–æ–∫–∞–∑ –∏—Å—Ç–æ—Ä–∏–∏ –≤ PricingPage.

–°–∫–∞–∂–∏ ‚Äî –¥–≤–∏–≥–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é/–±—ç–∫–µ–Ω–¥ –ø–µ—Ä–≤—ã–º —à–∞–≥–æ–º –∏ –∑–∞—Ç–µ–º —Ñ—Ä–æ–Ω—Ç?