отличный план. вот последовательность “крупными блоками”, без кода, чтобы довести фичу до боевого состояния.

1) Данные и Prisma
	1.	Новая таблица фильтров (org-level):
	•	competitor_filters
	•	id, orgId (FK → Organization), scope (‘ORG’ | ‘USER’ optional), userId? (для персональных override),
	•	диапазоны отклонений: lenFtMinus/lenFtPlus, yearMinus/yearPlus, peopleMinus/peoplePlus, cabinsMinus/cabinsPlus, headsMinus/headsPlus,
	•	прочее: pricePctRange, minRating,
	•	гео: массив locationIds (FK на справочник),
	•	служебные: createdAt/updatedAt, updatedBy.
	•	Миграция + индексы: @@unique([orgId, scope, userId]) для единственности набора на организацию/пользователя.
	2.	Справочник локаций:
	•	locations (id, code, name, countryCode, parentId?, source: ‘NAUSYS’|‘INTERNAL’, updatedAt).
	•	Таблица-связка, если понадобится мэппинг с нашими текстовыми маринами: location_aliases (alias, locationId).
	3.	Сохранить обратную совместимость:
	•	Скрейпер по-прежнему работает, если фильтры не заданы → использует дефолтные допуски.

2) Справочник локаций (NauSYS)
	4.	Сервис синхронизации локаций:
	•	Бэкенд-джоб/эндпоинт, который дергает NauSYS Locations API и обновляет/апсертит locations.
	•	Простая дедупликация (по внешнему nausysId/code).
	•	Привести к нормализованному виду (country, city, marina).
	5.	Кэширование и выдача на фронт:
	•	Публичный эндпоинт GET /api/locations?country=…&q=… с пагинацией.
	•	На фронте — lazy-загрузка для мультиселекта в форме.

3) Фронтенд — форма настроек
	6.	Заменяем текущие поля на отклонения от целевой яхты:
	•	Слева в UI — подсказки “Текущая яхта: 46 ft, 2017 г., 10 pax, 4c/4h” (read-only).
	•	Поля формы: ± feet, ± год, ± люди, ± кабины, минимум heads, ценовой коридор ±%, мин. рейтинг.
	•	Мультиселект локаций из справочника locations.
	7.	UX/валидации:
	•	Неблокирующие подсказки (например, “рекомендуем: длина ±3 ft для 40–50 ft”).
	•	Кнопки “Reset to defaults” (разумные дефолты) и “Save”.
	8.	Сохранение:
	•	POST /api/competitor-filters (создать/обновить) — org-level по умолчанию.
	•	(опционально) scope=user — персональные настройки поверх org.

4) Подключение к скраперу
	9.	Выдача фильтров клиенту скрапера:
	•	Dashboard при нажатии Scan:
	•		1.	грузит competitor_filters для org (и user override),
	•		2.	вычисляет от целевой яхты фактические границы (например, 46 ft ±3 → min=43, max=49),
	•		3.	передаёт в startScrape() расширенный DTO: minLength/maxLength (в футах), minYear/maxYear, people±, cabins±, headsMin, pricePctRange, locationIds.
	10.	Скрапер учитывает диапазоны:

	•	Внутри passesBusinessFilters() заменить/параметризовать хардкод: брать допуски из DTO; если не пришли — падать на дефолты.
	•	Гео-фильтр: если пришёл список locationIds — матчим кандидатов по locationId/алиасам; иначе — прежняя эвристика (страна/подстрока).
	•	Логгирование причин отбраковки сохраняем (для диагностики).

5) API и безопасность
	11.	Эндпоинты:

	•	GET /api/competitor-filters — текущие настройки (org + user override), RBAC: ADMIN/FLEET_MANAGER/MANAGER (в рамках org).
	•	POST /api/competitor-filters — сохранить (audit: updatedBy).
	•	GET /api/locations — справочник.

	12.	RBAC:

	•	Редактировать — ADMIN/FLEET_MANAGER, читать — все, кто видит Dashboard.
	•	Логи аудита (кто/когда поменял).

6) Дефолты, фича-флаг, раскатка
	13.	Дефолты фильтров:

	•	len ±3 ft (до 50 ft), год ±2, people ±1, cabins ±1, heads ≥ target, price ±20%, rating ≥ 4, без гео.
	•	Храним дефолт на бэке (чтобы одинаково для всех).

	14.	Feature flag:

	•	Включаем форму и передачу фильтров в скрапер по флагу (env/конфиг), чтобы проще катить.

	15.	Миграции/сидинг:

	•	Миграция Prisma → деплой.
	•	Однократный сид “дефолтный набор фильтров” для всех существующих org.

7) Наблюдаемость и тесты
	16.	Логи/метрики:

	•	В passesBusinessFilters оставляем структурированные логи (jobId, yachtId, причина), счётчики keep/drop.
	•	Метрики по времени и количеству кандидатов до/после фильтра.

	17.	Тест-план (кратко):

	•	Без фильтров (дефолт) и с кастомными — результаты отличаются ожидаемо.
	•	Гео по нескольким выбранным локациям.
	•	Разные роли и организация — видимость и сохранение настроек.
	•	Бэкенд падает на дефолты, если DTO пуст или частичный.

⸻

Если окей, дальше могу наметить конкретные поля моделей Prisma и контракты эндпоинтов (JSON-схемы), но в рамках этого плана ты уже видишь всю дорожную карту от БД до UI и скрапера.